<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">

<dom-module id="my-app">
  <template>
    <style>
      table {
        display: inline-block;
        background-color: white;
      }

      th {
        background-color: #ab0431;
        padding: 10px;
        font-size: 1.2em;
        color: white;
      }

      td {
        background-color: #80808052;
        color: black;
        font-size: 1em;
        text-align: left;
        padding-left: 10px;
      }

      div {
        text-align: center;
      }

      h1 {
        padding-left: 25px;
      }

      span {
        font-size: 20px;
        font-weight: bold;
      }
    </style>

    <h1>Serverless User Service</h1>
    <div>
      <div>
        <span>Users</span>
      </div>
      <div id="newUserForm" hidden>
        <label for="username">Username</label>
        <input id="username" type="text">
        <br>
        <label for="password">Password</label>
        <input id="password" type="text">
        <paper-icon-button icon="check" on-click="_handleCheckButtonClicked"></paper-icon-button> 
      </div>
      <table>
        <tr>
          <th>Username</th>
          <th>Password</th>
          <th>
            <paper-icon-button icon="autorenew" on-click="_handleRefreshButtonClicked"></paper-icon-button> 
            <paper-icon-button icon="add" on-click="_handleAddButtonClicked"></paper-icon-button>
          </th>
        </tr>
        <template is="dom-repeat" items="[[users]]" as="user">
          <tr>
            <td>[[user.Username]]</td>
            <td>[[user.Password]]</td>
            <td>
              <paper-icon-button icon="create" on-click="_handleEditButtonClicked"></paper-icon-button> 
              <paper-icon-button icon="delete" on-click="_handleDeleteButtonClicked"></paper-icon-button>
            </td> 
          </tr>
        </template>
      </table>
    </div>

    <iron-ajax
      id="getUsersRequest"
      method="GET"
      url="https://0wx01ys37k.execute-api.us-east-1.amazonaws.com/dev"
      handle-as="json"
      on-response="handleGetUsers"></iron-ajax>

    <iron-ajax
      id="addUserRequest"
      method="POST"
      url="https://0wx01ys37k.execute-api.us-east-1.amazonaws.com/dev"
      handle-as="json"
      on-response="handleUserAdded"></iron-ajax>

    <iron-ajax
      id="updateUserRequest"
      method="PUT"
      url="https://0wx01ys37k.execute-api.us-east-1.amazonaws.com/dev"
      handle-as="json"
      on-response="handleUserUpdated"></iron-ajax>  

    <iron-ajax
      id="deleteUserRequest"
      method="DELETE"
      url="https://0wx01ys37k.execute-api.us-east-1.amazonaws.com/dev"
      handle-as="json"
      on-response="handleUserDeleted"></iron-ajax>  
  </template>

  <script>
    Polymer.setPassiveTouchGestures(true);

    class MyApp extends Polymer.Element {
      static get is() { return 'my-app'; }

      static get properties() {
        return {
            users: {
              type: Array,
            }
        };
      }

      static get observers() {
        return [
        ];
      }

      handleGetUsers(event){
        this.set("users", event.detail.response);
      }

      handleUserAdded(event){
        console.log(event);
      }

      handleUserUpdated(event){

      }

      handleUserDeleted(event){
        console.log("User Deleted");
      }

      _handleRefreshButtonClicked(event){
        this.$.getUsersRequest.generateRequest();
      }

      _handleAddButtonClicked(event){
        this.$.newUserForm.hidden = false;
      }

      _handleDeleteButtonClicked(event){

      }

      _handleEditButtonClicked(event){

      }

      _handleCheckButtonClicked(event){
        var body = {};
        body.Username = this.$.username.value;
        body.Password = this.$.password.value;
        this.$.addUserRequest.body = body;
        this.$.addUserRequest.headers['Content-Type'] = "application/json";
        this.$.addUserRequest.generateRequest();
      }
    }

    window.customElements.define(MyApp.is, MyApp);
  </script>
</dom-module>
